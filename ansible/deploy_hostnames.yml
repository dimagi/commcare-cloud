- name: "Sets hostname"
  hosts: all
  become: yes
  tasks:

    - name: "Set hostname"
      hostname:
        name: "{{ hostname }}"
      when: hostname is defined

    - name: "Sets /etc/hosts"
      lineinfile:
        dest: /etc/hosts
        regexp: '^{{ ansible_default_ipv4.address }} '
        line: '{{ ansible_default_ipv4.address }} {{ hostname }}.{{ internal_domain_name }} {{ hostname }}'
      when: hostname is defined and internal_domain_name is defined
