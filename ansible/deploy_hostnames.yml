- name: "Sets hostname"
  hosts: all
  become: yes
  tasks:
    - name: Debug
      debug: 
        msg: "System {{ inventory_hostname }} has uuid {{ ansible_default_ipv4.address }}"

    - name: "Set hostname"
      hostname:
        name: "{{ inventory_hostname }}"
      when: domain_name is defined

    - name: "Sets /etc/hosts"
      lineinfile:
        dest: /etc/hosts
        regexp: '^{{ ansible_default_ipv4.address }} '
        line: '{{ ansible_default_ipv4.address }} {{ inventory_hostname }}.{{ domain_name }}'
      when: domain_name is defined
