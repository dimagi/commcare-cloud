- name: define management command services
  become: yes
  template:
    src: "{{ supervisor_service_files.management_commands.template }}"
    dest: "{{ supervisor_service_files.management_commands.file_path }}"
    owner: "{{ cchq_user }}"
    group: "{{ cchq_user }}"
    mode: 0644
  when: supervisor_service_files.management_commands.should_exist
  with_items:
    - env_vars:
        TMPDIR: '{{ encrypted_tmp }}'
        PROMETHEUS_MULTIPROC_DIR: "{% if prometheus_monitoring_enabled|default(False) %}{{ metrics_home }}{% endif %}"
        DD_ENV: "{{ env_monitoring_id }}"
        DD_SERVICE: "management_command"
        # Set app-processes.yml:management_commands.<host>.<command>.env_vars.DD_TRACE_ENABLED=True
        # to enable APM on management commands.
        DD_TRACE_ENABLED: False
        DD_INSTRUMENTATION_TELEMETRY_ENABLED: False
