[program:{{ project }}-{{ deploy_env }}-django]
directory={{ code_home }}/
; gunicorn
environment={% for name, value in [item, app_processes_config.webworkers]|env_vars %}{{ name }}="{{ value }}",{% endfor %}

command={{ app_processes_config.django_command_prefix }}
    {%- if app_processes_config.webworkers.env_vars.DD_TRACE_ENABLED|default(False) -%}
    {{ virtualenv_home }}/bin/ddtrace-run {% endif -%}
    {{ virtualenv_home }}/bin/gunicorn
    deployment.gunicorn.commcarehq_wsgi:application
    -c deployment/gunicorn/gunicorn_conf.py
    -k gevent
    --workers {{ item.gunicorn_workers }}
    --bind 0.0.0.0:{{ django_port }}
    --log-file {{ log_home }}/{{ project }}.gunicorn.log
    --log-level debug
    --statsd-host localhost:8125
    --pid {{ www_home }}/gunicorn.pid
user={{ cchq_user }}
autostart=true
autorestart=true
stdout_logfile={{ log_home }}/django.log
redirect_stderr=true
stderr_logfile={{ log_home }}/django.error.log
;stopsignal=QUIT
;stopwaitsecs=60
;killasgroup=true
;stopasgroup=false
