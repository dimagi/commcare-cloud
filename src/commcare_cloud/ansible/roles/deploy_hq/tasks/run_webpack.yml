- name: Check for webpack configuration
  # We can eventually remove this when all of HQ is on Webpack
  stat:
    path: "{{ code_source }}/webpack"
  register: webpack_config_directory

- name: Generate Webpack Settings
  # generates webpack/settings.json so that webpack has the same path
  # to STATIC_ROOT as django
  command:
    cmd: ./manage.py generate_webpack_settings
    chdir: '{{ code_source }}'
  when: webpack_config_directory.stat.exists

- name: Build Webpack Bundles
  # Builds all the webpack bundles
  command:
    cmd: yarn build
    chdir: '{{ code_source }}'
  when: webpack_config_directory.stat.exists
