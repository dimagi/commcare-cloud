{"notify_list":[],"description":"","template_variables":[{"default":"*","prefix":"environment","name":"environment"},{"default":"*","prefix":"domain","name":"domain"}],"is_read_only":false,"id":"g9s-pw6-tpg","title":"HQ vitals","url":"/dashboard/g9s-pw6-tpg/hq-vitals","created_at":"2015-10-16T14:57:20.098883+00:00","modified_at":"2020-06-30T11:34:35.471763+00:00","author_handle":"skelly@dimagi.com","widgets":[{"definition":{"widgets":[{"definition":{"title":"Successful Submissions from by domain","yaxis":{"max":"auto","include_zero":true,"scale":"linear","min":"auto","label":""},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"sum:commcare.xform_submissions.count{$environment,status_code:201} by {domain}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}]},"id":387748524},{"definition":{"title":"gunicorn response time (avg, 95th percentile & max; max rollup)","legend_size":"0","markers":[{"display_type":"error dashed","value":"y = 7"}],"show_legend":false,"requests":[{"q":"avg:gunicorn.request.duration.avg{$environment}.rollup(max)","style":{"line_width":"thin","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:gunicorn.request.duration.95percentile{$environment}.rollup(max)","style":{"line_width":"normal","palette":"purple","line_type":"solid"},"display_type":"line"},{"q":"avg:gunicorn.request.duration.max{$environment}.rollup(max)","style":{"line_width":"normal","palette":"purple","line_type":"solid"},"display_type":"line"},{"q":"avg:gunicorn.request.duration.median{$environment}.rollup(max)","style":{"line_width":"normal","palette":"purple","line_type":"solid"},"display_type":"line"}],"type":"timeseries","events":[{"q":"tags:$environment Deploy Successful ","tags_execution":"and"}]},"id":412036159},{"definition":{"title":"HQ webworker response time (avg, 95th percentile & max; max rollup)","legend_size":"0","markers":[{"display_type":"error dashed","value":"y = 7"}],"show_legend":false,"requests":[{"q":"avg:gunicorn.request.duration.avg{$environment,group:hq_webworkers}.rollup(max)","style":{"line_width":"thin","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:gunicorn.request.duration.95percentile{$environment,group:hq_webworkers}.rollup(max)","style":{"line_width":"normal","palette":"purple","line_type":"solid"},"display_type":"line"},{"q":"avg:gunicorn.request.duration.max{$environment,group:hq_webworkers}.rollup(max)","style":{"line_width":"normal","palette":"purple","line_type":"solid"},"display_type":"line"},{"q":"avg:gunicorn.request.duration.median{$environment,group:hq_webworkers}.rollup(max)","style":{"line_width":"normal","palette":"purple","line_type":"solid"},"display_type":"line"}],"type":"timeseries","events":[{"q":"tags:$environment Deploy Successful ","tags_execution":"and"}]},"id":65612738},{"definition":{"title":"Mobile webworker response time (avg, 95th percentile & max; max rollup)","legend_size":"0","markers":[{"display_type":"error dashed","value":"y = 7"}],"show_legend":false,"requests":[{"q":"avg:gunicorn.request.duration.avg{$environment,group:mobile_webworkers}.rollup(max)","style":{"line_width":"thin","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:gunicorn.request.duration.95percentile{$environment,group:mobile_webworkers}.rollup(max)","style":{"line_width":"normal","palette":"purple","line_type":"solid"},"display_type":"line"},{"q":"avg:gunicorn.request.duration.max{$environment,group:mobile_webworkers}.rollup(max)","style":{"line_width":"normal","palette":"purple","line_type":"solid"},"display_type":"line"},{"q":"avg:gunicorn.request.duration.median{$environment,group:mobile_webworkers}.rollup(max)","style":{"line_width":"normal","palette":"purple","line_type":"solid"},"display_type":"line"}],"type":"timeseries","events":[{"q":"tags:$environment Deploy Successful","tags_execution":"and"}]},"id":4790447997931832},{"definition":{"title":"Nginx response time","yaxis":{"include_zero":false,"scale":"sqrt"},"markers":[{"display_type":"error dashed","value":"y = 7"}],"legend_size":"0","show_legend":false,"requests":[{"q":"avg:nginx.timings{$environment} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","events":[{"q":"tags:$environment Deploy Successful ","tags_execution":"and"}]},"id":272836918},{"definition":{"title":"Nginx apdex","yaxis":{"max":"1","include_zero":false},"legend_size":"0","show_legend":false,"requests":[{"q":"avg:nginx.apdex{$environment} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","events":[{"q":"tags:$environment Deploy Successful ","tags_execution":"and"}]},"id":381496532},{"definition":{"requests":[{"q":"sum:nginx.net.request_per_s{$environment}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Nginx Requests / s"},"id":65612750},{"definition":{"requests":[{"q":"sum:nginx.net.connections{$environment}, sum:nginx.net.writing{$environment}, sum:nginx.net.waiting{$environment}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Nginx connections"},"id":371274461},{"definition":{"title":"Nginx response time (avg, log scale)","yaxis":{"include_zero":false,"scale":"log"},"markers":[{"display_type":"error dashed","value":"y = 7"}],"show_legend":false,"requests":[{"q":"avg:nginx.timings{$environment} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:gunicorn.request.duration.avg{$environment}","style":{"line_width":"normal","palette":"dog_classic","line_type":"dotted"},"display_type":"line"}],"type":"timeseries","legend_size":"0"},"id":383182718},{"definition":{"title":"HQ 500 errors (as % or requests)","yaxis":{"max":"100","scale":"log","include_zero":false},"markers":[{"display_type":"error dashed","value":"y = 1"}],"legend_size":"0","show_legend":false,"requests":[{"q":"sum:nginx.requests{$environment,status_code:500} by {url_group}*100/sum:nginx.requests{$environment}","style":{"line_width":"normal","palette":"warm","line_type":"solid"},"display_type":"area"}],"type":"timeseries","events":[{"q":"tags:$environment Deploy Successful ","tags_execution":"and"}]},"id":65612754},{"definition":{"title":"Errors rate limited (by service / by host group)","yaxis":{"scale":"sqrt"},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"sum:commcare.sentry.errors.rate_limited{$environment} by {service}.as_count()","style":{"line_width":"normal","palette":"warm","line_type":"solid"},"display_type":"bars"},{"q":"-sum:commcare.sentry.errors.rate_limited{$environment} by {group}.as_count()","style":{"line_width":"normal","palette":"cool","line_type":"solid"},"display_type":"bars"}]},"id":200684876},{"definition":{"title":"Requests by status code (rate)","yaxis":{"max":"auto","include_zero":true,"scale":"linear","min":"auto","label":""},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"sum:nginx.requests{$environment} by {status_code}.as_rate()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"area"}]},"id":383300999},{"definition":{"requests":[{"q":"sum:commcare.xform_submissions.count{$environment} by {submission_type}.as_rate()","display_type":"area"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Form submission rate by submission_type"},"id":200542368},{"definition":{"requests":[{"q":"sum:nginx.requests{$environment} by {url_group}.as_rate()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Requests by url group (per second)"},"id":201899728},{"definition":{"requests":[{"q":"sum:commcare.xform_submissions.duration.seconds{$environment} by {duration}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Form submission timing"},"id":200981468},{"definition":{"requests":[{"q":"sum:commcare.restores.count{$environment} by {status_code}.as_rate()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"area"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Successful Restore rate"},"id":198911016},{"definition":{"title":"Restore Count by Time Bucket","yaxis":{"include_zero":false},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"sum:commcare.restores.duration.seconds{$environment} by {duration}.as_count()","style":{"line_width":"normal","palette":"cool","line_type":"solid"},"display_type":"bars"}]},"id":198911019},{"definition":{"requests":[{"q":"avg:nginx.error_logs{$environment,log_level:error} by {error_type}.as_count()","style":{"line_width":"normal","palette":"orange","line_type":"solid"},"display_type":"bars"},{"q":"avg:nginx.error_logs{$environment,log_level:warn} by {error_type}.as_count()","style":{"line_width":"normal","palette":"purple","line_type":"solid"},"display_type":"bars"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Nginx error/warn"},"id":3599407412324190},{"definition":{"requests":[{"q":"top(sum:nginx.requests{$environment} by {url_group}.as_count(), 25, 'sum', 'desc')","style":{"palette":"dog_classic"}}],"type":"toplist","title":"Top requests"},"id":1371239684749932},{"definition":{"title":"Rate limiting by URL group","yaxis":{"max":"auto","include_zero":true,"scale":"linear","min":"auto","label":""},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"100*sum:nginx.requests{$environment,status_code:503} by {url_group}.as_count().rollup(sum)/sum:nginx.requests{$environment} by {url_group}.as_count().rollup(sum)","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}]},"id":925199813712256},{"definition":{"requests":[{"q":"100*sum:nginx.requests{url_group:phone/restore,$environment} by {status_code}.as_count()/sum:nginx.requests{url_group:phone/restore,$environment}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"area"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Restore requests by status code (%)"},"id":4114301157210736},{"definition":{"requests":[{"q":"100*sum:nginx.requests{$environment,url_group:receiver} by {status_code}.as_count()/sum:nginx.requests{$environment,url_group:receiver}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"area"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Form submission requests by status code (%)"},"id":5610529191195484},{"definition":{"requests":[{"q":"top(sum:commcare.xform_submissions.count{$environment} by {domain}.as_count(), 50, 'sum', 'desc')","style":{"palette":"dog_classic"}}],"type":"toplist","title":"Top Submissions"},"id":7313496062182138},{"definition":{"requests":[{"q":"top(sum:commcare.mobile_workers.count{$environment,!domain:_other} by {domain}, 50, 'mean', 'desc')","style":{"palette":"dog_classic"}}],"type":"toplist","title":"Top Mobile Worker Count"},"id":2561817180267664},{"definition":{"requests":[{"q":"avg:commcare.active_mobile_workers.count{$environment,!domain:_other} by {domain}.fill(last, 86500)"}],"type":"toplist","title":"Top Active Mobile Worker Count"},"id":2552906308521022},{"definition":{"title":"Nginx rate limiting by zone","yaxis":{"max":"auto","include_zero":true,"scale":"linear","min":"auto","label":""},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"avg:nginx.rate_limiting{$environment} by {zone}.as_rate()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}]},"id":8572460685163050},{"definition":{"title":"Sum of nginx.bytes_sent over $environment by url_group","yaxis":{"max":"auto","include_zero":true,"scale":"linear","min":"auto","label":""},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"sum:nginx.bytes_sent{$environment} by {url_group}, sum:nginx.bytes_received{$environment} by {url_group}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}]},"id":6201292500898397}],"layout_type":"ordered","type":"group","title":"Requests & Errors"},"id":7051525359522110},{"definition":{"widgets":[{"definition":{"requests":[{"q":"avg:system.mem.used{$environment,group:webworkers} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:system.mem.total{$environment,group:webworkers} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"dashed"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Webworker RAM usage"},"id":379828613},{"definition":{"requests":[{"q":"sum:gunicorn.requests{$environment} by {group}.as_rate()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"area"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"gunicorn requests/s by group"},"id":375465210},{"definition":{"title":"gunicorn response time by host (max rollup of median, sqrt to accentuate difference)","yaxis":{"scale":"sqrt"},"markers":[{"display_type":"error dashed","value":"y = 7"}],"legend_size":"0","show_legend":false,"requests":[{"q":"max:gunicorn.request.duration.median{$environment} by {group}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","events":[{"q":"tags:$environment Deploy Successful ","tags_execution":"and"}]},"id":375295042},{"definition":{"title":"Gunicorn workers in use (%)","yaxis":{"max":"100"},"markers":[{"display_type":"error dashed","value":"y = 100"}],"show_legend":false,"requests":[{"q":"100*sum:gunicorn.workers{$environment,state:working} by {group}.rollup(max)/(sum:gunicorn.workers{$environment,state:idle} by {group}.rollup(min)+sum:gunicorn.workers{$environment,state:working} by {group}.rollup(max))","style":{"line_width":"normal","palette":"purple","line_type":"solid"},"display_type":"line","metadata":[{"alias_name":"% Workers in use","expression":"100*sum:gunicorn.workers{$environment,state:working} by {group}.rollup(max)/(sum:gunicorn.workers{$environment,state:idle} by {group}.rollup(min)+sum:gunicorn.workers{$environment,state:working} by {group}.rollup(max))"}]}],"type":"timeseries","legend_size":"0"},"id":273353334},{"definition":{"title":"Gunicorn workers in use","yaxis":{"max":"auto","include_zero":true,"scale":"linear","min":"auto","label":""},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"sum:gunicorn.workers{$environment,state:working} by {group}.rollup(max)","style":{"line_width":"normal","palette":"purple","line_type":"solid"},"display_type":"line"},{"q":"sum:gunicorn.workers{$environment,state:idle} by {group}+sum:gunicorn.workers{$environment,state:working} by {group}","style":{"line_width":"normal","palette":"purple","line_type":"dashed"},"display_type":"line"}]},"id":1919746117676436},{"definition":{"title":"gunicorn response time by host (avg)","legend_size":"0","markers":[{"display_type":"error dashed","value":"y = 7"}],"show_legend":false,"requests":[{"q":"avg:gunicorn.request.duration.avg{$environment} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","events":[{"q":"tags:$environment Deploy Successful ","tags_execution":"and"}]},"id":406795560566138},{"definition":{"title":"HQ django throughput (rps)","events":[{"q":"tags:environment:$environment ","tags_execution":"and"}],"show_legend":false,"requests":[{"q":"avg:gunicorn.requests{$environment} by {host}.as_rate()","style":{"palette":"cool"}}],"type":"heatmap","legend_size":"0"},"id":65613526},{"definition":{"title":"Webworker CPU percent usage","yaxis":{"max":"100"},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"100-min:system.cpu.idle{$environment,group:webworkers} by {host}.rollup(min)","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}]},"id":379741435},{"definition":{"tick_pos":"50%","show_tick":false,"type":"note","tick_edge":"left","text_align":"left","content":"[Gunicorn Dashboard](https://app.datadoghq.com/dashboard/4pe-6ue-ens/gunicorn---overview-cloned)","font_size":"14","background_color":"white"},"id":5316509652900088}],"layout_type":"ordered","type":"group","title":"Webworkers"},"id":4348976180168260},{"definition":{"widgets":[{"definition":{"requests":[{"q":"avg:system.net.bytes_sent{$environment} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Network bytes Sent"},"id":297503562},{"definition":{"requests":[{"q":"avg:system.net.bytes_rcvd{$environment} by {host}","style":{"palette":"dog_classic"}}],"type":"heatmap","legend_size":"0","show_legend":false,"title":"Network bytes Received"},"id":297503042},{"definition":{"style":{"fill_min":"0","fill_max":"1","palette":"green_to_orange","palette_flip":false},"group":["group"],"title":"Host Map (color = load, size = free mem)","no_metric_hosts":true,"scope":["$environment"],"requests":{"size":{"q":"avg:system.mem.pct_usable{$environment} by {host}"},"fill":{"q":"avg:system.load.norm.1{$environment} by {host}"}},"no_group_hosts":true,"type":"hostmap"},"id":65613737},{"definition":{"title":"io.util - https://stackoverflow.com/a/35509278/10840","markers":[{"display_type":"warning dashed","value":"y = 80"},{"display_type":"error solid","value":"y = 90"}],"show_legend":false,"requests":[{"q":"avg:system.io.util{$environment} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0"},"id":375137663},{"definition":{"requests":[{"q":"max:aws.ec2.status_check_failed_system{$environment} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"max:aws.ec2.status_check_failed_instance{$environment} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"EC2 Status checks failed by host"},"id":408264249},{"definition":{"requests":[{"q":"top(sum:system.cpu.stolen{$environment} by {host}, 5, 'mean', 'desc')","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"CPU Stolen (top 5 smoothed)"},"id":6091579424832652},{"definition":{"requests":[{"q":"outliers(avg:system.load.norm.1{$environment} by {host}, 'DBSCAN', 3)","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Normalized load average by host (1=100% CPU)"},"id":195950917},{"definition":{"requests":[{"q":"avg:shell.vmware.swap{$environment} by {host}, avg:shell.vmware.balloon{$environment} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Avg of shell.vmware.swap over $environment by host"},"id":7184405178508148},{"definition":{"title":"% Disk in use","yaxis":{"max":"auto","include_zero":true,"scale":"linear","min":"auto","label":""},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"max:system.disk.in_use{$environment} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}]},"id":3503749409657753}],"layout_type":"ordered","type":"group","title":"Hosts"},"id":4642782479378816},{"definition":{"widgets":[{"definition":{"title":"Couch request time percentiles (50, 75, 90, 95, 99)","yaxis":{"include_zero":false,"scale":"sqrt"},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"avg:couchdb.couchdb.request_time.percentile.99{$environment}","style":{"line_width":"thin","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:couchdb.couchdb.request_time.percentile.50{$environment}","style":{"line_width":"thin","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:couchdb.couchdb.request_time.percentile.75{$environment}","style":{"line_width":"thin","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:couchdb.couchdb.request_time.percentile.90{$environment}","style":{"line_width":"thin","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:couchdb.couchdb.request_time.percentile.95{$environment}","style":{"line_width":"thin","palette":"dog_classic","line_type":"solid"},"display_type":"line"}]},"id":65612779},{"definition":{"title":"Average Couch request duration by database","yaxis":{"include_zero":false,"scale":"sqrt"},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"avg:couch.timings{$environment,!couch_url:_changes} by {database}.rollup(max)","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}]},"id":5452649440584162},{"definition":{"title":"Average Couch request duration by host group","yaxis":{"include_zero":false,"scale":"sqrt"},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"sum:couch.timings{$environment,!couch_url:_changes} by {group}.rollup(sum)","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}]},"id":383628302},{"definition":{"title":"Latency on couchdb2 (PROD ONLY)","yaxis":{"include_zero":false,"scale":"sqrt"},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"avg:trace.requests.request.duration.by.service.50p{env:production,service::25984}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:trace.requests.request.duration.by.service.75p{env:production,service::25984}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:trace.requests.request.duration.by.service.90p{env:production,service::25984}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:trace.requests.request.duration.by.service.95p{env:production,service::25984}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:trace.requests.request.duration.by.service.99p{env:production,service::25984}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}]},"id":396627867},{"definition":{"title":"Error status codes on couchdb2","yaxis":{"scale":"sqrt"},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"sum:trace.requests.request.errors{service::25984,$environment} by {group}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}]},"id":401648558},{"definition":{"title":"All status codes on couchdb2","yaxis":{"include_zero":false,"scale":"log"},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"sum:trace.requests.request.hits{service::25984,$environment} by {http.status_code}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}]},"id":1437096585010208},{"definition":{"title":"Sum of couchdb.fabric.open_shard.timeouts over $environment","yaxis":{"min":"0"},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"diff(sum:couchdb.fabric.open_shard.timeouts{$environment})","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}]},"id":3879466675155630},{"definition":{"requests":[{"q":"max:couchdb.active_tasks.indexer.count{$environment} by {instance}.rollup(max)","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Active indexers by couch node (max rollup)"},"id":4714887564414386},{"definition":{"requests":[{"q":"max:couchdb.couchdb.db_open_time.percentile.99{$environment} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"DB Open time"},"id":1264361985091936},{"definition":{"requests":[{"q":"max:system.cpu.stolen{$environment,group:couchdb2} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Stolen CPU"},"id":8131319452908240},{"definition":{"title":"% Disk in use","yaxis":{"max":"110","min":"0"},"markers":[{"display_type":"error dashed","value":"y = 100","label":"\u00a0full\u00a0"}],"show_legend":false,"requests":[{"q":"max:system.disk.in_use{$environment,group:couchdb2} by {host}*100","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0"},"id":8706171276586532},{"definition":{"tick_pos":"50%","show_tick":false,"type":"note","tick_edge":"left","text_align":"left","content":"For more detail see [CouchDB Dashboard](https://app.datadoghq.com/screen/177642/couchdb-dashboard)","font_size":"16","background_color":"blue"},"id":2903389362694796}],"layout_type":"ordered","type":"group","title":"CouchDB"},"id":8364683275069660},{"definition":{"widgets":[{"definition":{"requests":[{"q":"sum:postgresql.rows_fetched{$environment} by {db,host}, sum:postgresql.rows_returned{$environment} by {db,host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"PostgreSQL rows fetched / returned"},"id":65613162},{"definition":{"requests":[{"q":"sum:postgresql.rows_inserted{$environment}, sum:postgresql.rows_deleted{$environment}, sum:postgresql.rows_updated{$environment}","style":{"palette":"dog_classic"},"display_type":"line"},{"q":"sum:postgresql.rows_inserted{$environment}, sum:postgresql.rows_deleted{$environment}, sum:postgresql.rows_updated{$environment}","style":{"palette":"dog_classic"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"PostgreSQL inserts / updates / deletes (rows / s)"},"id":65613056},{"definition":{"requests":[{"q":"sum:pgbouncer.pools.cl_active{$environment} by {host}.rollup(max)","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Pgbouncer client connections by host (max rollup)"},"id":190465595},{"definition":{"requests":[{"q":"avg:pgbouncer.pools.cl_waiting{$environment} by {host}","display_type":"area"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"PG bouncer connections waiting"},"id":199449170},{"definition":{"requests":[{"q":"sum:postgresql.connections{$environment} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"sum:aws.rds.database_connections{$environment} by {dbinstanceidentifier}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"PostgreSQL connections by Host"},"id":65613374},{"definition":{"requests":[{"q":"avg:pgbouncer.stats.avg_transaction_time{$environment,!*} by {db,host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Avg transaction time"},"id":3690909248692276},{"definition":{"requests":[{"q":"sum:system.io.await{$environment,group:postgresql} by {host,device}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Disk IO Latency"},"id":1780126538630174},{"definition":{"requests":[{"q":"sum:system.cpu.stolen{$environment,group:postgresql} by {host}, sum:system.cpu.stolen{$environment,group:citusdb} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"CPU Stolen"},"id":7334851011763930},{"definition":{"tick_pos":"50%","show_tick":false,"type":"note","tick_edge":"left","text_align":"left","content":"For more detail see [PostgreSQL Dashboard](https://app.datadoghq.com/dashboard/unt-6cf-nbs/postgres---overview)","font_size":"16","background_color":"blue"},"id":4696814201290214}],"layout_type":"ordered","type":"group","title":"PostgreSQL & PGBouncer"},"id":4106792492082010},{"definition":{"widgets":[{"definition":{"requests":[{"q":"per_minute(avg:elasticsearch.search.query.time{$environment})/per_minute(avg:elasticsearch.search.query.total{$environment})*1000","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"per_minute(avg:elasticsearch.search.fetch.time{$environment})/per_minute(avg:elasticsearch.search.fetch.total{$environment})*1000","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Elasticsearch query and fetch latency"},"id":271743284},{"definition":{"title":"ES Partial Results (shard failure)","yaxis":{"include_zero":false,"scale":"log"},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"sum:commcare.es.partial_results{$environment}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}]},"id":4079489701328082},{"definition":{"requests":[{"q":"per_second(sum:elasticsearch.search.query.total{$environment})","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Elasticsearch Searches / second"},"id":271743637},{"definition":{"requests":[{"q":"per_second(avg:elasticsearch.get.total{$environment} by {node_name})","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Elasticsearch Gets / second"},"id":271743759},{"definition":{"tick_pos":"50%","show_tick":false,"type":"note","tick_edge":"left","text_align":"left","content":"[Elasticsearch Dashboard](https://app.datadoghq.com/dashboard/i95-ynu-eqb/elasticsearch-timeboard)","font_size":"14","background_color":"blue"},"id":1072449527075484}],"layout_type":"ordered","type":"group","title":"Elasticsearch"},"id":947547473129060},{"definition":{"widgets":[{"definition":{"requests":[{"q":"avg:riakcs.object_get_time_99{$environment}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:riakcs.object_put_time_99{$environment}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:riakcs.object_delete_time_99{$environment}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"RiakCS timing"},"id":202575213},{"definition":{"requests":[{"q":"avg:riak.node_gets{$environment} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Riak Gets by host"},"id":202328080},{"definition":{"requests":[{"q":"avg:riak.node_puts{$environment} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Riak Puts by host"},"id":202328930},{"definition":{"title":"S3 Blobdb timings","yaxis":{"include_zero":false,"scale":"log"},"legend_size":"0","show_legend":false,"requests":[{"q":"sum:commcare.blobs.requests.timing{$environment} by {duration}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}],"type":"timeseries","events":[{"q":"tags:$environment Deploy Successful","tags_execution":"and"}]},"id":330097790},{"definition":{"title":"S3 Blobdb timings (bucket: 'blobdb')","yaxis":{"include_zero":false,"scale":"log"},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"sum:commcare.blobs.requests.timing{$environment,s3_bucket_name:blobdb} by {duration}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}]},"id":330103588},{"definition":{"title":"S3 Blobdb timings (bucket: 'mowcddb-c1')","yaxis":{"include_zero":false,"scale":"log"},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"sum:commcare.blobs.requests.timing{$environment,s3_bucket_name:mowcddb-c1} by {duration}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}]},"id":355205876},{"definition":{"title":"S3 Blobdb timings PRODUCTION (bucket: 'dimagi-commcare-production-blobdb')","yaxis":{"include_zero":false,"scale":"log"},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"sum:commcare.blobs.requests.timing{$environment,s3_bucket_name:dimagi-commcare-production-blobdb} by {duration}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}]},"id":366000512},{"definition":{"title":"Objects Missing","yaxis":{"include_zero":false,"scale":"log"},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"sum:commcare.blobdb.notfound{$environment}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}]},"id":2854634735955020},{"definition":{"tick_pos":"50%","show_tick":false,"type":"note","tick_edge":"left","text_align":"left","content":"[BlobDB Dashboard](https://app.datadoghq.com/dashboard/753-35q-fwt/blob-db-dashboard)","font_size":"14","background_color":"blue"},"id":6188114146059320}],"layout_type":"ordered","type":"group","title":"Blobdb"},"id":5445122637216276},{"definition":{"widgets":[{"definition":{"requests":[{"q":"avg:redis.info.latency_ms{$environment} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Redis Latency"},"id":202618817},{"definition":{"requests":[{"q":"sum:redis.slowlog.micros.95percentile{$environment} by {command}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Redis Slow Log (95p by command)"},"id":202619222},{"definition":{"requests":[{"q":"avg:redis.net.clients{$environment} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Redis Clients"},"id":202620769},{"definition":{"title":"Redis Cache hit rate","markers":[{"display_type":"ok dashed","value":"y = 100","label":"Ideal hit rate"},{"display_type":"error dashed","value":"y = 75","label":"Investigate"}],"show_legend":false,"requests":[{"q":"(avg:redis.stats.keyspace_hits{$environment} by {host}/(avg:redis.stats.keyspace_hits{$environment} by {host}+avg:redis.stats.keyspace_misses{$environment} by {host}))*100","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0"},"id":202620788},{"definition":{"requests":[{"q":"sum:system.cpu.stolen{$environment,group:redis} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"CPU Stolen"},"id":1195738395406572},{"definition":{"tick_pos":"50%","show_tick":false,"type":"note","tick_edge":"left","text_align":"left","content":"For more on redis see [Redis Timeboard](https://app.datadoghq.com/dashboard/tr7-nw2-bgb/redis-timeboard)","font_size":"14","background_color":"blue"},"id":6153958238565820}],"layout_type":"ordered","type":"group","title":"Redis"},"id":337808563436716},{"definition":{"title":"Pillow processing rates","events":[{"q":"tags:$environment deploy ","tags_execution":"and"}],"show_legend":false,"requests":[{"q":"sum:commcare.change_feed.changes.count{$environment} by {pillow_name}.as_rate()","display_type":"line"}],"type":"timeseries","legend_size":"0"},"id":200532503},{"definition":{"requests":[{"q":"avg:commcare.submission_reprocessing.queue_size{$environment}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Form reprocessing queue"},"id":333210101},{"definition":{"requests":[{"q":"sum:commcare.submission_reprocessing.count{$environment}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Reprocessed forms"},"id":333210054},{"definition":{"requests":[{"q":"per_minute(sum:celery.tasks_completed{$environment} by {celery_queue})","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Celery Tasks Completed (/s)"},"id":294057009539838},{"definition":{"requests":[{"q":"avg:celery.tasks_queued{$environment} by {celery_queue}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Celery tasks queued"},"id":6744376844845204},{"definition":{"tick_pos":"50%","show_tick":false,"type":"note","tick_edge":"left","text_align":"left","content":"Links to other dashboards:\n\n* [Celery](https://app.datadoghq.com/dashboard/bdu-k5b-bz5/celery-overview?from_ts=1562146642332&to_ts=1562751442332&live=true)\n* [Changefeeds](https://app.datadoghq.com/dashboard/ewu-jyr-udt/change-feeds-pillows)","font_size":"14","background_color":"blue"},"id":4021036092561444}],"layout_type":"ordered"}