{"notify_list":[],"description":"An overview of your Postgres metrics (cloned)","template_variables":[{"default":"production","prefix":"environment","name":"env"},{"default":"*","prefix":"host","name":"host"},{"default":"*","prefix":"group","name":"pg_group"},{"default":"pg_standby","prefix":"group","name":"exclusions"}],"is_read_only":false,"id":"unt-6cf-nbs","title":"Postgres - Overview","url":"/dashboard/unt-6cf-nbs/postgres---overview","created_at":"2017-03-20T12:17:06.666237+00:00","modified_at":"2020-07-01T03:33:01.831731+00:00","author_handle":"skelly@dimagi.com","widgets":[{"definition":{"widgets":[{"definition":{"requests":[{"q":"sum:postgresql.connections{$env,$host,$pg_group,!$exclusions} by {db}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Connections (by DB)"},"id":188861317},{"definition":{"requests":[{"q":"sum:postgresql.connections{$env,$host,$pg_group,!$exclusions} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Connections by host"},"id":256956002},{"definition":{"title":"Pgbouncer Active connections","events":[{"q":"tags:$env Deploy Success ","tags_execution":"and"}],"show_legend":false,"requests":[{"q":"sum:pgbouncer.pools.cl_active{$env,$host,$pg_group,!$exclusions} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0"},"id":256956003},{"definition":{"requests":[{"q":"avg:postgresql.connections.state{$env,$host,$pg_group,!$exclusions} by {state}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"area"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Connections by state"},"id":391331707},{"definition":{"requests":[{"q":"sum:pgbouncer.pools.cl_waiting{$env,$host,$pg_group,!$exclusions} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"pgbouncer clients waiting"},"id":391332138},{"definition":{"requests":[{"q":"sum:pgbouncer.stats.transactions_per_second{$env,$host,$pg_group,!$exclusions} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Pgbouncer transactions per second"},"id":258422206}],"layout_type":"ordered","type":"group","title":"Connections"},"id":5358654407065922},{"definition":{"requests":[{"q":"avg:postgresql.rows_fetched{$env,$host,$pg_group,!$exclusions} by {host}","style":{"line_width":"normal","palette":"purple","line_type":"solid"},"display_type":"line"},{"q":"avg:postgresql.rows_returned{$env,$host,$pg_group,!$exclusions} by {host}","style":{"line_width":"normal","palette":"orange","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Rows fetched (purple) / returned (orange) (per sec)"},"id":188861316},{"definition":{"title":"Inserts (orange) / updates (purple) / deletes (gray) (per sec) (sqrt scale)","yaxis":{"include_zero":false,"scale":"sqrt"},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"avg:postgresql.rows_inserted{$env,$host,$pg_group,!$exclusions} by {host}","style":{"line_width":"normal","palette":"orange","line_type":"solid"},"display_type":"line"},{"q":"avg:postgresql.rows_deleted{$env,$host,$pg_group,!$exclusions} by {host}","style":{"line_width":"normal","palette":"grey","line_type":"solid"},"display_type":"line"},{"q":"avg:postgresql.rows_updated{$env,$host,$pg_group,!$exclusions} by {host}","style":{"line_width":"normal","palette":"purple","line_type":"solid"},"display_type":"line"}]},"id":188861318},{"definition":{"title":"Disk IO utilization (%)","yaxis":{"max":"auto","include_zero":true,"scale":"linear","min":"auto","label":""},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"outliers(avg:system.io.util{$env,$host,group:postgresql,$pg_group} by {host,device}, 'DBSCAN', 1.5), outliers(avg:system.io.util{$env,$host,group:pg_standby,$pg_group} by {host,device}, 'DBSCAN', 1.5), outliers(avg:system.io.util{$env,$host,$pg_group,group:citusdb,!group:pg_standby} by {host,device}, 'DBSCAN', 1.5)","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}]},"id":188861319},{"definition":{"title":"System load (normalized)","legend_size":"0","markers":[{"display_type":"error dashed","value":"y = 1"}],"show_legend":false,"requests":[{"q":"avg:system.load.norm.1{$env,$host,group:postgresql,$pg_group,!$exclusions} by {host}, avg:system.load.norm.1{$env,$host,group:pg_standby,$pg_group,!$exclusions} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:system.load.norm.1{$env,$host,$pg_group,!$exclusions,group:citusdb} by {host}, avg:system.load.norm.1{$env,$host,group:pg_standby,$pg_group,!$exclusions,group:citusdb} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","events":[{"q":"$scope ","tags_execution":"and"}]},"id":188861320},{"definition":{"requests":[{"q":"avg:system.cpu.idle{$env,$host,$pg_group,!$exclusions}, avg:system.cpu.system{$env,$host,$pg_group,!$exclusions}, avg:system.cpu.iowait{$env,$host,$pg_group,!$exclusions}, avg:system.cpu.user{$env,$host,$pg_group,!$exclusions}, avg:system.cpu.stolen{$env,$host,$pg_group,!$exclusions}, avg:system.cpu.guest{$env,$host,$pg_group,!$exclusions}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"area"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"CPU usage (%)"},"id":188861321},{"definition":{"requests":[{"q":"outliers(max:system.cpu.iowait{$env,$host,group:postgresql,$pg_group,!$exclusions} by {host}, 'DBSCAN', 3), outliers(max:system.cpu.iowait{$env,$host,group:pg_standby,$pg_group,!$exclusions} by {host}, 'DBSCAN', 3)","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"outliers(max:system.cpu.iowait{$env,$host,$pg_group,!$exclusions,group:citusdb} by {host}, 'DBSCAN', 3), outliers(max:system.cpu.iowait{$env,$host,group:pg_standby,$pg_group,!$exclusions,group:citusdb} by {host}, 'DBSCAN', 3)","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"I/O wait (%)"},"id":188861322},{"definition":{"requests":[{"q":"sum:system.mem.usable{$env,$host,$pg_group,!$exclusions}, sum:system.mem.total{$env,$host,$pg_group,!$exclusions}-sum:system.mem.usable{$env,$host,$pg_group,!$exclusions}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"area","metadata":[{"alias_name":"mem.free","expression":"sum:system.mem.usable{$env,$host,$pg_group,!$exclusions}"},{"alias_name":"mem.used","expression":"sum:system.mem.total{$env,$host,$pg_group,!$exclusions}-sum:system.mem.usable{$env,$host,$pg_group,!$exclusions}"}]}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"System memory"},"id":188861323},{"definition":{"title":"CPU usage","yaxis":{"max":"auto","include_zero":true,"scale":"linear","min":"auto","label":""},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"100-avg:system.cpu.idle{$env,$host,$pg_group} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}]},"id":4804224538509940},{"definition":{"requests":[{"q":"avg:system.mem.used{$env,$host,$pg_group,group:postgresql,!$exclusions} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:system.mem.used{$env,$host,$pg_group,group:citusdb,!$exclusions} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Memory usage"},"id":4883102234198048},{"definition":{"requests":[{"q":"avg:system.swap.used{$env,$host,$pg_group,group:postgresql,!$exclusions} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:system.swap.used{$env,$host,$pg_group,group:citusdb,!$exclusions} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Swap usage"},"id":6291828926884720},{"definition":{"style":{"palette":"green_to_orange","palette_flip":false},"group":["group"],"title":"Nodes","no_metric_hosts":true,"scope":["$env","$host","$pg_group"],"requests":{"size":{"q":"avg:system.mem.free{$env,$host,$pg_group} by {host}"},"fill":{"q":"avg:system.load.norm.1{$env,$host,$pg_group} by {host}"}},"no_group_hosts":true,"type":"hostmap"},"id":403110372},{"definition":{"requests":[{"q":"sum:system.net.bytes_rcvd{$env,$host,$pg_group,!$exclusions}, sum:system.net.bytes_sent{$env,$host,$pg_group,!$exclusions}","style":{"line_width":"normal","palette":"cool","line_type":"solid"},"display_type":"area"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Network traffic (kb/s)"},"id":188861324},{"definition":{"requests":[{"q":"avg:postgresql.replication_delay{$env,$host,$pg_group} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Replication delay by host"},"id":253462140},{"definition":{"requests":[{"q":"max:pgbouncer.stats.avg_query_time{$env,$host,$pg_group,!$exclusions} by {db,host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Avg query time by DB"},"id":295542364},{"definition":{"requests":[{"q":"max:pgbouncer.stats.total_query_time{$env,$host,$pg_group,!$exclusions} by {db,host}, max:pgbouncer.stats.total_transaction_time{$env,$host,$pg_group,!$exclusions} by {db,host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Total transaction / query time by DB"},"id":295542429},{"definition":{"requests":[{"q":"avg:pgbouncer.stats.avg_transaction_time{$env,$host,$pg_group,!$exclusions} by {db,host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Avg transaction time"},"id":306008584},{"definition":{"title":"Disk usage by host (%)","markers":[{"display_type":"error dashed","value":"y > 80"}],"show_legend":false,"requests":[{"q":"forecast(avg:system.disk.in_use{$env,$host,device:/opt/data,group:pg_standby,$pg_group} by {host}*100,'linear',1)","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"forecast(avg:system.disk.in_use{$env,$host,device:/opt/data,group:postgresql,$pg_group} by {host}*100,'linear',1)","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"forecast(avg:system.disk.in_use{$env,$host,device:/opt/data,group:citusdb,$pg_group,!group:pg_standby} by {host}*100,'linear',1)","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0"},"id":377635046},{"definition":{"title":"Disk used","yaxis":{"max":"auto","include_zero":true,"scale":"linear","min":"auto","label":""},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"avg:system.disk.used{$env,$host,group:postgresql,device:/opt/data,$pg_group} by {host}, avg:system.disk.used{$env,$host,device:/opt/data,group:pg_standby,$pg_group} by {host}, avg:system.disk.used{$env,$host,device:/opt/data,group:citusdb,$pg_group,!group:pg_standby} by {host}, avg:system.disk.used{$env,$host,group:postgresql,device:/opt/data,$pg_group} by {host}-month_before(avg:system.disk.used{$env,$host,group:postgresql,device:/opt/data,$pg_group} by {host}), avg:system.disk.used{$env,$host,device:/opt/data,group:pg_standby,$pg_group} by {host}-month_before(avg:system.disk.used{$env,$host,device:/opt/data,group:pg_standby,$pg_group} by {host}), avg:system.disk.used{$env,$host,device:/opt/data,group:citusdb,$pg_group,!group:pg_standby} by {host}-month_before(avg:system.disk.used{$env,$host,device:/opt/data,group:citusdb,$pg_group,!group:pg_standby} by {host})","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}]},"id":400095739},{"definition":{"requests":[{"q":"sum:system.io.r_s{$env,$host,$pg_group,group:postgresql,!$exclusions} by {host}, sum:system.io.w_s{$env,$host,$pg_group,group:postgresql,!$exclusions} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"sum:system.io.r_s{$env,$host,$pg_group,!$exclusions,group:pg_standby} by {host}, sum:system.io.w_s{$env,$host,$pg_group,!$exclusions,group:pg_standby} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"sum:system.io.r_s{$env,$host,$pg_group,group:citusdb,!$exclusions,!group:pg_standby} by {host}, sum:system.io.w_s{$env,$host,$pg_group,group:citusdb,!group:pg_standby,!$exclusions} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Disk IOPS (all disks)"},"id":4805352332658496},{"definition":{"requests":[{"q":"avg:pgbouncer_custom.clients.count{environment:icds,$host,!$exclusions} by {client_addr}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Avg of pgbouncer_custom.clients.count over $env,$host,$pg_group by client_addr"},"id":2807384574149948},{"definition":{"requests":[{"q":"avg:system.io.avg_q_sz{$env,$host,$pg_group,!$exclusions} by {host,device}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Disk IO Queue size by host"},"id":6107450355609014},{"definition":{"requests":[{"q":"avg:system.io.rkb_s{$env,$host,$pg_group,!$exclusions} by {host,device}, -avg:system.io.wkb_s{$env,$host,$pg_group,!$exclusions} by {host,device}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Disk reads / writes kb per s"},"id":3713912890413730},{"definition":{"requests":[{"q":"avg:postgresql.database_size{$env,$pg_group,$host,!$exclusions} by {db}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"DB Size"},"id":7844467893393443},{"definition":{"requests":[{"q":"sum:postgresql.deadlocks{$env,$host,$pg_group,!$exclusions} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"area"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Deadlock (by host)"},"id":4209376176946968},{"definition":{"requests":[{"q":"sum:postgresql.locks.not_granted{$env,$host,$pg_group,!$exclusions} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Locks not granted (by host)"},"id":6649602022880068}],"layout_type":"ordered"}