{"notify_list":[],"description":"","template_variables":[{"default":"production","prefix":"environment","name":"env"},{"default":"*","prefix":"pillow_name","name":"pillow"}],"is_read_only":false,"id":"ewu-jyr-udt","title":"Change Feeds (pillows)","url":"/dashboard/ewu-jyr-udt/change-feeds-pillows","created_at":"2017-03-03T20:45:08.882610+00:00","modified_at":"2020-04-02T14:07:09.050856+00:00","author_handle":"brudolph@dimagi.com","widgets":[{"definition":{"requests":[{"q":"top(sum:commcare.change_feed.changes.count{$env,$pillow} by {datasource}.as_count(), 20, 'sum', 'desc')"}],"type":"toplist","title":"Total changes by datasource"},"id":185102681},{"definition":{"title":"Pillow Error queue size (by pillow) See: https://www.commcarehq.org/admin/pillow_retry/pillowerror/","events":[{"q":"tags:$env Deploy Successful","tags_execution":"and"}],"show_legend":false,"requests":[{"q":"max:commcare.pillowtop.error_queue{$env,$pillow} by {pillow_name}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"area"}],"type":"timeseries","legend_size":"0"},"id":253784658},{"definition":{"requests":[{"q":"top(sum:commcare.change_feed.changes.count{$env,$pillow} by {pillow_name}.as_count(), 20, 'sum', 'desc')","style":{"palette":"dog_classic"}}],"type":"toplist","title":"Total changes by pillow"},"id":5897485575654444},{"definition":{"title":"Changes processed by pillow","yaxis":{"max":"auto","include_zero":true,"scale":"linear","min":"auto","label":""},"legend_size":"0","show_legend":false,"requests":[{"q":"sum:commcare.change_feed.changes.count{$env,$pillow} by {pillow_name}.as_count()","style":{"line_width":"normal","palette":"warm","line_type":"solid"},"display_type":"bars"}],"type":"timeseries","events":[{"q":"tags:$env Deploy Successful ","tags_execution":"and"}]},"id":185100827},{"definition":{"title":"Changes to process by pillow","yaxis":{"include_zero":false,"min":"0"},"legend_size":"0","show_legend":false,"requests":[{"q":"sum:commcare.change_feed.need_processing{$env,$pillow} by {pillow_name}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","events":[{"q":"tags:$env Deploy Successful ","tags_execution":"and"}]},"id":186199249},{"definition":{"title":"Changes to process by pillow (couch feed)","yaxis":{"include_zero":false,"scale":"sqrt","min":"0"},"legend_size":"0","show_legend":false,"requests":[{"q":"sum:commcare.change_feed.need_processing{$env,feed_type:couch,$pillow} by {pillow_name}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","events":[{"q":"tags:$env Deploy Successful ","tags_execution":"and"}]},"id":1713217311719910},{"definition":{"title":"Processing time by pillow (avg)","yaxis":{"scale":"sqrt"},"show_legend":false,"time":{},"requests":[{"q":"avg:commcare.change_feed.processing_time.avg{$env,$pillow} by {pillow_name}, sum:commcare.change_feed.processing_time.total{$env,$pillow} by {pillow_name}.as_count()/sum:commcare.change_feed.processing_time.count{$env,$pillow} by {pillow_name}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0"},"id":186601744},{"definition":{"title":"Changes produced","yaxis":{"max":"auto","include_zero":true,"scale":"linear","min":"auto","label":""},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"diff(sum:commcare.change_feed.current_offsets{$env,feed_type:kafka,$pillow} by {topic})","style":{"line_width":"normal","palette":"cool","line_type":"solid"},"display_type":"bars"}]},"id":189517806},{"definition":{"requests":[{"q":"top(top(max:commcare.change_feed.change_lag{$env,$pillow} by {pillow_name}, 10, 'last', 'desc'), 20, 'mean', 'desc')"}],"type":"toplist","title":"Pillow lag (top 10)"},"id":210568792},{"definition":{"requests":[{"q":"top(sum:commcare.change_feed.need_processing{$env,$pillow} by {pillow_name}, 20, 'last', 'desc')","style":{"palette":"cool"}}],"type":"toplist","title":"Changes to process"},"id":186160633},{"definition":{"requests":[{"q":"top(sum:commcare.change_feed.changes.count{$env,$pillow} by {pillow_name}.as_rate(), 10, 'mean', 'desc')"}],"type":"toplist","title":"Avg rate of changes processed by pillow"},"id":185104373},{"definition":{"requests":[{"q":"top(sum:commcare.change_feed.processing_time.total{$env,$pillow} by {pillow_name}.as_count()/sum:commcare.change_feed.processing_time.count{$env,$pillow} by {pillow_name}.as_count(),10,'mean','desc')"}],"time":{},"type":"toplist","title":"Average time to process a change by pillow"},"id":186602884},{"definition":{"title":"Pillow lag (realtime)","yaxis":{"max":"72000","scale":"sqrt"},"markers":[{"display_type":"warning dashed","value":"y = 600"}],"legend_size":"0","show_legend":false,"requests":[{"q":"max:commcare.change_feed.change_lag{$env,$pillow} by {pillow_name,topic}.rollup(max)","style":{"line_width":"normal","palette":"warm","line_type":"solid"},"display_type":"line"}],"type":"timeseries","events":[{"q":"tags:$env Deploy Successful","tags_execution":"and"}]},"id":210889790},{"definition":{"title":"Pillow lag (max per batch)","yaxis":{"scale":"sqrt"},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"max:commcare.change_feed.chunked.max_change_lag{$env,$pillow} by {pillow_name}.rollup(max)","style":{"line_width":"normal","palette":"cool","line_type":"solid"},"display_type":"line"}]},"id":3845479150817126},{"definition":{"requests":[{"q":"top(sum:commcare.xform_submissions.count{$env,$pillow} by {domain}.as_count(), 5, 'l2norm', 'desc')","display_type":"area"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Form submissions by domain (top 5)"},"id":211359693},{"definition":{"title":"Difference in pillow backlog","events":[{"q":"deploy ","tags_execution":"and"}],"show_legend":false,"requests":[{"q":"diff(sum:commcare.change_feed.need_processing{$env,feed_type:kafka,$pillow} by {pillow_name})","display_type":"bars"}],"type":"timeseries","legend_size":"0"},"id":226968203},{"definition":{"requests":[{"q":"sum:commcare.load.case{$env,src:form_submission,$pillow}.as_rate()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Cases modified by forms (/s)"},"id":253179827},{"definition":{"requests":[{"q":"(1-avg:system.mem.pct_usable{$env,group:pillowtop,$pillow} by {host})*100","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Memory usage (% used)"},"id":265293246},{"definition":{"requests":[{"q":"avg:system.load.norm.1{$env,group:pillowtop,$pillow} by {host}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Normalized load average on pillowtop machines"},"id":265282467},{"definition":{"requests":[{"q":"sum:commcare.change_feed.changes.count{$env,$pillow} by {pillow_name}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Changes by pillow"},"id":365689289},{"definition":{"requests":[{"q":"-sum:commcare.change_feed.changes.exceptions{$env,$pillow} by {pillow_name,host}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"},{"q":"sum:commcare.change_feed.changes.exceptions{$env,$pillow} by {pillow_name}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Pillow error counts"},"id":6286460760256228},{"definition":{"title":"Pillow error counts  by exception type","yaxis":{"max":"auto","include_zero":true,"scale":"linear","min":"auto","label":""},"legend_size":"0","show_legend":false,"requests":[{"q":"sum:commcare.change_feed.changes.exceptions{$env,$pillow} by {exception_type}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}],"type":"timeseries","events":[{"q":"tags:$env Deploy Successful","tags_execution":"and"}]},"id":7506126596336992},{"definition":{"requests":[{"q":"sum:commcare.change_feed.changes.count{$env,pillow_name:case-pillow,$pillow} by {case_type}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Case changes by case type"},"id":6600364388971518},{"definition":{"title":"Changes to process by partition (case pillow)","yaxis":{"scale":"sqrt"},"legend_size":"0","show_legend":false,"requests":[{"q":"avg:commcare.change_feed.need_processing{$env,pillow_name:case-pillow,$pillow} by {topic}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:commcare.change_feed.need_processing{$env,$pillow,pillow_name:case-pillow-dashboard} by {topic}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","events":[{"q":"tags:$env Deploy Successful","tags_execution":"and"}]},"id":5334637021137196},{"definition":{"title":"Changes to process by partition (form pillow)","yaxis":{"max":"auto","include_zero":true,"scale":"linear","min":"auto","label":""},"legend_size":"0","show_legend":false,"requests":[{"q":"avg:commcare.change_feed.need_processing{$env,pillow_name:xform-pillow,$pillow} by {topic}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"},{"q":"avg:commcare.change_feed.need_processing{$env,$pillow,pillow_name:xform-pillow-dashboard} by {topic}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","events":[{"q":"tags:$env Deploy Successful","tags_execution":"and"}]},"id":3887554712528992},{"definition":{"requests":[{"q":"avg:commcare.change_feed.need_processing{$env,$pillow,pillow_name:case-pillow-non-dashboard} by {topic}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Changes to process by partition (case pillow non dashboard)"},"id":3501916574983854},{"definition":{"requests":[{"q":"avg:commcare.change_feed.need_processing{$env,$pillow,pillow_name:xform-pillow-non-dashboard} by {topic}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Changes to process by partition (form pillow non dashboard)"},"id":1362116929204486},{"definition":{"title":"Changes to process by partition (all kafka)","yaxis":{"scale":"sqrt"},"show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"avg:commcare.change_feed.need_processing{$env,$pillow,feed_type:kafka} by {topic,pillow_name}","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"line"}]},"id":8678672662495496},{"definition":{"requests":[{"q":"avg:commcare.change_feed.batch_processor_exceptions{$env,$pillow} by {pillow_name,processor}.as_count()","style":{"line_width":"normal","palette":"dog_classic","line_type":"solid"},"display_type":"bars"}],"type":"timeseries","legend_size":"0","show_legend":false,"title":"Batch exceptions"},"id":4621869211163228},{"definition":{"requests":[{"change_type":"absolute","order_dir":"asc","compare_to":"hour_before","q":"max:commcare.change_feed.processed_offsets{$env,$pillow} by {topic}","increase_good":true,"order_by":"change"}],"type":"change","title":"Checkpoint progression over last hour"},"id":5385539111972790},{"definition":{"requests":[{"q":"top(max:commcare.change_feed.processed_offsets{$env,$pillow} by {topic}, 10000, 'max', 'desc')"}],"type":"toplist","title":"Daily max checkpoint (useful for pillow rewinds)"},"id":6108962243717710}],"layout_type":"ordered"}