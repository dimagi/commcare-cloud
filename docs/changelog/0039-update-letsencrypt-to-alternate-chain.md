<!--THIS FILE IS AUTOGENERATED: DO NOT EDIT-->
<!--See https://github.com/dimagi/commcare-cloud/blob/master/changelog/README.md for instructions-->
# 39. update-letsencrypt-to-alternate-chain

**Date:** 2020-11-16

**Optional per env:** _only required on some environments_


## CommCare Version Dependency
This change is not known to be dependent on any particular version of CommCare.


## Change Context
On January 11 2021, Let's Encrypt will change its default certificate chain from using the legacy Identrust
root certificate, to its own modern ISRG root certificate. In order to maintain backwards compatibility with
existing mobile devices it is necessary to keep using the Identrust certificate chain.

## Details
In order to maintain backwards compatibility it is necessary to configure certbot (the tool used to renew the
certificates) to continue using the Identrust certficiate chain.

Read more about that change on the Let's Encrypt [blog][1] and [forum post][2].

[1]: https://letsencrypt.org/2020/11/06/own-two-feet.html
[2]: https://community.letsencrypt.org/t/certbot-users-preparing-for-the-isrg-root-transition-january-11-2021/138059

## Steps to update
1. Check certbot version

  ```shell
  commcare-cloud <env> run-shell-command proxy -b "certbot --version"
  ```

  If the version is older than *1.6.0* you will need to update certbot.

2. (optional) Update certbot

  Run this if the installed version is lower than *1.6.0*.

  ```shell
  commcare-cloud <env> run-module proxy apt -b "name=certbot state=latest"
  ```

  Check the version again (see step 1) to ensure the version is >= 1.6.0.

3. Update the configuration

  ```shell
  commcare-cloud <env> run-module proxy lineinfile -b "line='preferred-chain = DST Root CA X3'"
  ```
