---
language: python
python:
  - "3.6"
os: linux
dist: bionic

env:
  global:
    - ANSIBLE_ROLES_PATH="~/.ansible/roles"
    - TRAVIS_TEST=1
    - PATH="$PATH:/opt/python/3.9/bin"
  matrix:
    - TEST=main

matrix:
  fast_finish: true

before_install:
  # Make sure everything's up to date.
  - sudo apt-get clean
  - sudo apt-get update -qq

install:
  - "source control/init.sh"
  # Note: the installs must be done in the following order, otherwise the installation of commcare-cloud
  # tries to install from the commcare-cloud-bootstrap.egg_info directory
  - "pip install -e .[test]"

  # Python 3.9 for deploy-stack in .travis/tests.sh
  # Remove when this file is updated to use 3.9 (see python version at top)
  - curl -sSf --retry 5 -o python-3.9.tar.bz2 'https://storage.googleapis.com/travis-ci-language-archives/python/binaries/ubuntu/18.04/x86_64/python-3.9.tar.bz2'
  - sudo tar xjf python-3.9.tar.bz2 --directory /

script:
  - ".travis/tests.sh"
